



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation">
      
      
        <meta name="author" content="Percona LLC">
      
      
      <link rel="icon" href="_images/percona_favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.3.9">
    
    
      
        <title>Set up LDAP authentication and authorization using NativeLDAP - Percona Server for MongoDB 5.0</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Chivo,+Colfax,+Franziska:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Chivo, Colfax, Franziska";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.3/css/line.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="css/percona.css">
    
      <link rel="stylesheet" href="css/nocopy.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
              

              <script>
              (function (w, d, s, l, i) {
                  w[l] = w[l] || []; w[l].push({
                    'gtm.start': new Date().getTime(), 
                    event: 'gtm.js'
                  });
                  var f = d.getElementsByTagName(s)[0],
                  j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
                  j.async = true; 
                  j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
                  f.parentNode.insertBefore(j, f);
                })(window, document, 'script', 'dataLayer', 'GTM-K48FGP2');
              </script>
              
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="percona-light" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#set-up-ldap-authentication-and-authorization-using-nativeldap" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://percona.com/software/documentation" class="md-header__button md-logo" aria-label="Percona Product Documentation" data-md-component="logo">
      
  <img src="_images/percona-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Percona Server for MongoDB 5.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Set up LDAP authentication and authorization using NativeLDAP
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="percona-light" data-md-color-primary="" data-md-color-accent="" type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="" type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Percona Server for MongoDB 5.0" class="md-nav__button md-logo" aria-label="Percona Server for MongoDB 5.0" data-md-component="logo">
      
  <img src="_images/percona-logo.svg" alt="logo">

    </a>
    Percona Server for MongoDB 5.0
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Percona Server for MongoDB 5.0 Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="comparison.html" class="md-nav__link">
        Percona Server for MongoDB feature comparison
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Install PSMDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Install PSMDB" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Install PSMDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/index.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/apt.html" class="md-nav__link">
        Installing Percona Server for MongoDB on Debian and Ubuntu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/yum.html" class="md-nav__link">
        Installing Percona Server for MongoDB on Red Hat Enterprise Linux and CentOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/tarball.html" class="md-nav__link">
        Installing Percona Server for MongoDB from binary tarball
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/docker.html" class="md-nav__link">
        Running Percona Server for MongoDB in a Docker Container
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Storage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Storage" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Storage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="inmemory.html" class="md-nav__link">
        Percona Memory Engine
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Backup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Backup" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Backup
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="hot-backup.html" class="md-nav__link">
        Hot Backup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="backup-cursor.html" class="md-nav__link">
        $backupCursor and $backupCursorExtend aggregation stages
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Authentication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Authentication" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Authentication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="authentication.html" class="md-nav__link">
        Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="enable-auth.html" class="md-nav__link">
        Enable authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="sasl-auth.html" class="md-nav__link">
        Set up LDAP authentication with SASL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="x509-ldap.html" class="md-nav__link">
        Set up x.509 authentication and LDAP authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="kerberos.html" class="md-nav__link">
        Set up Kerberos authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="authorization.html" class="md-nav__link">
        LDAP authorization
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Set up LDAP authentication and authorization using NativeLDAP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="ldap-setup.html" class="md-nav__link md-nav__link--active">
        Set up LDAP authentication and authorization using NativeLDAP
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-procedure" class="md-nav__link">
    Setup procedure
  </a>
  
    <nav class="md-nav" aria-label="Setup procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-tlsssl-connection-for-percona-server-for-mongodb" class="md-nav__link">
    Configure TLS/SSL connection for Percona Server for MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-roles-for-ldap-groups-in-percona-server-for-mongodb" class="md-nav__link">
    Create roles for LDAP groups in Percona Server for MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percona-server-for-mongodb-configuration" class="md-nav__link">
    Percona Server for MongoDB configuration
  </a>
  
    <nav class="md-nav" aria-label="Percona Server for MongoDB configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-without-username-transformation" class="md-nav__link">
    Access without username transformation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-with-username-transformation" class="md-nav__link">
    Access with username transformation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-configuration" class="md-nav__link">
    Active Directory configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Encryption
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Encryption" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Encryption
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="data-at-rest-encryption.html" class="md-nav__link">
        Data at rest encryption
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="vault.html" class="md-nav__link">
        HashiCorp Vault integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="kmip.html" class="md-nav__link">
        Using the Key Management Interoperability Protocol (KMIP)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="keyfile.html" class="md-nav__link">
        Local key management using a keyfile
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="encryption-mode-switch.html" class="md-nav__link">
        Migrating from key file encryption to HashiCorp Vault encryption
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="audit-logging.html" class="md-nav__link">
        Auditing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="rate-limit.html" class="md-nav__link">
        Profiling Rate Limit
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="log-redaction.html" class="md-nav__link">
        Log Redaction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="ngram-full-text-search.html" class="md-nav__link">
        Additional text search algorithm - ngram
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Manage PSMDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Manage PSMDB" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Manage PSMDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="set-parameter.html" class="md-nav__link">
        Tune parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_2">
          Upgrade
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Upgrade" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Upgrade
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/upgrade-from-44.html" class="md-nav__link">
        Upgrade PSMDB from 4.4 to 5.0
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/upgrade-from-mongodb.html" class="md-nav__link">
        Upgrading Percona Server for MongoDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="install/uninstall.html" class="md-nav__link">
        Uninstall Percona Server for MongoDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Release notes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Release notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/index.html" class="md-nav__link">
        Percona Server for MongoDB 5.0 Release Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.13-11.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.13-11 (2022-10-12)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.11-10.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.11-10 (2022-09-01)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.10-9.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.10-9 (2022-08-09)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.9-8.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.9-8 (2022-06-20)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.8-7.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.8-7 (2022-05-10)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.7-6.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.7-6 (2022-04-20)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.6-5.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.6-5 (2022-02-10)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.5-4.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.5-4 (2021-12-28)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.4-3.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.4-3 (Release Candidate) (2021-12-08)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.3-2.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.3-2 (Release Candidate) (2021-10-14)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="release_notes/5.0.2-1.html" class="md-nav__link">
        Percona Server for MongoDB 5.0.2-1 (Release Candidate) (2021-08-16)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="glossary.html" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Copyright and Licensing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Copyright and Licensing" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Copyright and Licensing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="copyright.html" class="md-nav__link">
        Copyright and Licensing Information
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Trademark policy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Trademark policy" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Trademark policy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="trademark-policy.html" class="md-nav__link">
        Trademark Policy
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
   <label class="md-nav__title" for="__drawer">
    <a href="https://learn.percona.com/download-percona-server-mongodb-5-0-manual" onclick="_gaq.push(['b._trackEvent', 'Percona Server for MongoDB', 'Download', 'Download Manual Percona Server for MongoDB']);" class="md-nav__link md-nav__link--active">
      Download PDF
    </a>
  </label> 
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#assumptions" class="md-nav__link">
    Assumptions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-procedure" class="md-nav__link">
    Setup procedure
  </a>
  
    <nav class="md-nav" aria-label="Setup procedure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configure-tlsssl-connection-for-percona-server-for-mongodb" class="md-nav__link">
    Configure TLS/SSL connection for Percona Server for MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-roles-for-ldap-groups-in-percona-server-for-mongodb" class="md-nav__link">
    Create roles for LDAP groups in Percona Server for MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#percona-server-for-mongodb-configuration" class="md-nav__link">
    Percona Server for MongoDB configuration
  </a>
  
    <nav class="md-nav" aria-label="Percona Server for MongoDB configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-without-username-transformation" class="md-nav__link">
    Access without username transformation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#access-with-username-transformation" class="md-nav__link">
    Access with username transformation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#active-directory-configuration" class="md-nav__link">
    Active Directory configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

                <!-- Edit and view button -->
                
                  
                  
                  <a
                    href="https://github.com/percona/psmdb-docs/edit/5.0/docs/ldap-setup.md"
                    title="Edit this page"
                    class="md-content__button md-icon"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
                  </a>
                  <a
                    href="https://raw.githubusercontent.com/percona/psmdb-docs/5.0/docs/ldap-setup.md"
                    title="View source of this page"
                    class="md-content__button md-icon"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
                  </a>
                

                <!--
                  Hack: check whether the content contains a h1 headline. If it
                  doesn't, the page title (or respectively site name) is used
                  as the main headline.
                -->
                

                <!-- Markdown content -->
                <h1 id="set-up-ldap-authentication-and-authorization-using-nativeldap">Set up LDAP authentication and authorization using NativeLDAP</h1>
<p>This document describes an example configuration of LDAP authentication and authorization using direct binding to an LDAP server (Native LDAP). We recommend testing this setup in a non-production environment first, before applying it in production.</p>
<h2 id="assumptions">Assumptions</h2>
<ol>
<li>
<p>The setup of an LDAP server is out of scope of this document. We assume that you are familiar with the LDAP server schema.</p>
</li>
<li>
<p>You have the LDAP server up and running and it is accessible to the servers with Percona Server for MongoDB installed.</p>
</li>
<li>
<p>This document primarily focuses on OpenLDAP used as the LDAP server and the examples are given based on the OpenLDAP format. If you are using Active Directory, refer to the <a href="#active-directory-configuration">Active Directory configuration</a> section.</p>
</li>
<li>
<p>You have the <code>sudo</code> privilege to the server with the Percona Server for MongoDB installed.</p>
</li>
</ol>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>
<p>In this setup we use anonymous binds to the LDAP server. If your LDAP server disallows anonymous binds, create the user that Percona Server for MongoDB will use to connect to and query the LDAP server. Define this user’s credentials for the <code>security.ldap.bind.queryUser</code> and <code>security.ldap.bind.queryPassword</code>  parameters in the <code>mongod.conf</code> configuration file.</p>
</li>
<li>
<p>In this setup, we use the following OpenLDAP groups:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code>dn: cn=testusers,dc=percona,dc=com
objectClass: groupOfNames
cn: testusers
member: cn=alice,dc=percona,dc=com

dn: cn=otherusers,dc=percona,dc=com
objectClass: groupOfNames
cn: otherusers
member: cn=bob,dc=percona,dc=com
</code></pre></div>
<h2 id="setup-procedure">Setup procedure</h2>
<h3 id="configure-tlsssl-connection-for-percona-server-for-mongodb">Configure TLS/SSL connection for Percona Server for MongoDB</h3>
<p>By default, Percona Server for MongoDB establishes the TLS connection when binding to the LDAP server and thus, it requires access to the LDAP  certificates. To make Percona Server for MongoDB aware of the certificates, do the following:</p>
<ol>
<li>
<p>Place the certificate in the <code>certs</code> directory. The path to the <code>certs</code> directory is:</p>
<ul>
<li>
<p>On Debian / Ubuntu: <code>/etc/ssl/certs/</code></p>
</li>
<li>
<p>On RHEL / CentOS: <code>/etc/openldap/certs/</code></p>
</li>
</ul>
</li>
<li>
<p>Specify the path to the certificates in the <code>ldap.conf</code> file:</p>
<div class="tabbed-set" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><label for="__tabbed_1_1">Debian / Ubuntu</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>tee -a /etc/openldap/ldap.conf &lt;&lt;EOF
TLS_CACERT /etc/ssl/certs/my_CA.crt
EOF
</code></pre></div>
</div>
<input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><label for="__tabbed_1_2">RHEL and derivatives</label><div class="tabbed-content">
<div class="highlight"><pre><span></span><code>tee -a /etc/openldap/ldap.conf &lt;&lt;EOF
TLS_CACERT /etc/openldap/certs/my_CA.crt
EOF
</code></pre></div>
</div>
</div>
</li>
</ol>
<h3 id="create-roles-for-ldap-groups-in-percona-server-for-mongodb">Create roles for LDAP groups in Percona Server for MongoDB</h3>
<p>Percona Server for MongoDB authorizes users based on LDAP group membership. For every group, you must create the role in the <code>admin</code> database with the name that exactly matches the DN of the LDAP group.</p>
<p>Percona Server for MongoDB maps the user’s LDAP group to the roles and determines what role is assigned to the user. Percona Server for MongoDB then grants privileges defined by this role.</p>
<p>To create the roles, use the following command:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">getSiblingDB</span><span class="p">(</span><span class="s2">&quot;admin&quot;</span><span class="p">)</span><span class="w"></span>
<span class="nx">db</span><span class="p">.</span><span class="nx">createRole</span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cn=testusers,dc=percona,dc=com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">     </span><span class="nx">privileges</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">     </span><span class="nx">roles</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;readWrite&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>

<span class="nx">db</span><span class="p">.</span><span class="nx">createRole</span><span class="p">(</span><span class="w"></span>
<span class="w">   </span><span class="p">{</span><span class="w"></span>
<span class="w">     </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;cn=otherusers,dc=percona,dc=com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">     </span><span class="nx">privileges</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span><span class="w"></span>
<span class="w">     </span><span class="nx">roles</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;read&quot;</span><span class="p">]</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<h3 id="percona-server-for-mongodb-configuration">Percona Server for MongoDB configuration</h3>
<h4 id="access-without-username-transformation">Access without username transformation</h4>
<p>This section assumes that users connect to Percona Server for MongoDB by providing their LDAP DN as the username.</p>
<ol>
<li>
<p>Edit the Percona Server for MongoDB configuration file (by default, <code>/etc/mongod.conf</code>) and specify the following configuration:</p>
<div class="highlight"><pre><span></span><code><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enabled&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">transportSecurity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls</span><span class="w"></span>
<span class="w">    </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dc=percona,dc=com??sub?(&amp;(objectClass=groupOfNames)(member={PROVIDED_USER}))&quot;</span><span class="w"></span>

<span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
<p>The <code>{PROVIDED_USER}</code> variable substitutes the provided username before authentication or username transformation takes place.</p>
<p>Replace <code>ldap.example.com</code> with the hostname of your LDAP server. In the LDAP query template, replace the domain controllers <code>percona</code> and <code>com</code> with those relevant to your organization.</p>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>$ mongo -u <span class="s2">&quot;cn=alice,dc=percona,dc=com&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
<h4 id="access-with-username-transformation">Access with username transformation</h4>
<p>If users connect to Percona Server for MongoDB with usernames that are not LDAP DN, you need to transform these usernames to be accepted by the LDAP server.</p>
<p>Using the <code>--ldapUserToDNMapping</code> configuration parameter allows you to do this. You specify the match pattern as a regexp to capture a username. Next, specify how to transform it - either to use a substitution value or to query the LDAP server for a username.</p>
<p>If you don’t know what the substitution or LDAP query string should be, please consult with the LDAP administrators to figure this out.</p>
<p>Note that you can use only the <code>query</code> or the <code>substitution</code> stage, the combination of two is not allowed.</p>
<div class="tabbed-set" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><label for="__tabbed_2_1">Substitution</label><div class="tabbed-content">
<ol>
<li>
<p>Edit the Percona Server for MongoDB configuration file (by default, <code>/etc/mongod.conf</code>) and specify the <code>userToDNMapping</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enabled&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">transportSecurity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls</span><span class="w"></span>
<span class="w">    </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dc=percona,dc=com??sub?(&amp;(objectClass=groupOfNames)(member={USER}))&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">userToDNMapping</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">          </span><span class="no">[</span><span class="w"></span>
<span class="w">            </span><span class="no">{</span><span class="w"></span>
<span class="w">              </span><span class="no">match: &quot;([^@]+)@percona\\.com&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">substitution: &quot;CN={0},DC=percona,DC=com&quot;</span><span class="w"></span>
<span class="w">            </span><span class="no">}</span><span class="w"></span>
<span class="w">          </span><span class="no">]</span><span class="w"></span>

<span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
<p>The <code>{USER}</code> variable substitutes the username transformed during the <code>userToDNMapping</code> stage.</p>
<p>Modify the given example configuration to match your deployment.</p>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>$ mongo -u <span class="s2">&quot;alice@percona.com&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
</div>
<input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><label for="__tabbed_2_2">LDAP query</label><div class="tabbed-content">
<ol>
<li>
<p>Edit the Percona Server for MongoDB configuration file (by default, <code>/etc/mongod.conf</code>) and specify the <code>userToDNMapping</code> parameter:</p>
<div class="highlight"><pre><span></span><code><span class="nt">security</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;enabled&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">transportSecurity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls</span><span class="w"></span>
<span class="w">    </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">       </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dc=percona,dc=com??sub?(&amp;(objectClass=groupOfNames)(member={USER}))&quot;</span><span class="w"></span>
<span class="w">    </span><span class="nt">userToDNMapping</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">          </span><span class="no">[</span><span class="w"></span>
<span class="w">            </span><span class="no">{</span><span class="w"></span>
<span class="w">              </span><span class="no">match: &quot;([^@]+)@percona\\.com&quot;,</span><span class="w"></span>
<span class="w">              </span><span class="no">ldapQuery: &quot;dc=percona,dc=com??sub?(&amp;(objectClass=organizationalPerson)(cn={0}))&quot;</span><span class="w"></span>
<span class="w">            </span><span class="no">}</span><span class="w"></span>
<span class="w">          </span><span class="no">]</span><span class="w"></span>

<span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
<p>The <code>{USER}</code> variable substitutes the username transformed during the userToDNMapping stage.</p>
<p>Modify the given example configuration to match your deployment, For example, replace <code>ldap.example.com</code> with the hostname of your LDAP server. Replace the domain controllers (DC) <code>percona</code> and <code>com</code> with those relevant to your organization. Depending on your LDAP schema, further modifications of the LDAP query may be required.</p>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>mongo -u <span class="s2">&quot;alice&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
</div>
</div>
<h3 id="active-directory-configuration">Active Directory configuration</h3>
<p>Microsoft Active Directory uses a different schema for user and group definition. To illustrate Percona Server for MongoDB configuration, we will use the following AD users:</p>
<div class="highlight"><pre><span></span><code>dn:CN=alice,CN=Users,DC=testusers,DC=percona,DC=com
userPrincipalName: alice@testusers.percona.com
memberOf: CN=testusers,CN=Users,DC=percona,DC=com

dn:CN=bob,CN=Users,DC=otherusers,DC=percona,DC=com
userPrincipalName: bob@otherusers.percona.com
memberOf: CN=otherusers,CN=Users,DC=percona,DC=com
</code></pre></div>
<p>The following are respective  groups:</p>
<div class="highlight"><pre><span></span><code>dn:CN=testusers,CN=Users,DC=percona,DC=com
member:CN=alice,CN=Users,DC=testusers,DC=example,DC=com

dn:CN=otherusers,CN=Users,DC=percona,DC=com
member:CN=bob,CN=Users,DC=otherusers,DC=example,DC=com
</code></pre></div>
<p>Use one of the given Percona Server for MongoDB configurations for user authentication and authorization in Active Directory:</p>
<div class="tabbed-set" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><label for="__tabbed_3_1">No username transformation</label><div class="tabbed-content">
<ol>
<li>
<p>Edit the <code>/etc/mongod.conf</code> configuration file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DC=percona,DC=com??sub?(&amp;(objectClass=group)(member:1.2.840.113556.1.4.1941:={PROVIDED_USER}))&quot;</span><span class="w"></span>

<span class="w">  </span><span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>$ mongo -u <span class="s2">&quot;CN=alice,CN=Users,DC=testusers,DC=percona,DC=com&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
</div>
<input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><label for="__tabbed_3_2">Username substitution</label><div class="tabbed-content">
<ol>
<li>
<p>Edit the <code>/etc/mongod.conf</code> configuration file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DC=percona,DC=com??sub?(&amp;(objectClass=group)(member:1.2.840.113556.1.4.1941:={USER}))&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">userToDNMapping</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">        </span><span class="no">[</span><span class="w"></span>
<span class="w">          </span><span class="no">{</span><span class="w"></span>
<span class="w">            </span><span class="no">match: &quot;([^@]+)@([^\\.]+)\\.percona\\.com&quot;,</span><span class="w"></span>
<span class="w">            </span><span class="no">substitution: &quot;CN={0},CN=Users,DC={1},DC=percona,DC=com&quot;</span><span class="w"></span>
<span class="w">          </span><span class="no">}</span><span class="w"></span>
<span class="w">        </span><span class="no">]</span><span class="w"></span>

<span class="w">  </span><span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>$ mongo -u <span class="s2">&quot;alice@percona.com&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
</div>
<input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><label for="__tabbed_3_3">LDAP query</label><div class="tabbed-content">
<ol>
<li>
<p>Edit the <code>/etc/mongod.conf</code> configuration file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">ldap</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">servers</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ldap.example.com&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">authz</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">queryTemplate</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DC=percona,DC=com??sub?(&amp;(objectClass=group)(member:1.2.840.113556.1.4.1941:={USER}))&quot;</span><span class="w"></span>
<span class="w">  </span><span class="nt">userToDNMapping</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span><span class="w"></span>
<span class="w">        </span><span class="no">[</span><span class="w"></span>
<span class="w">          </span><span class="no">{</span><span class="w"></span>
<span class="w">            </span><span class="no">match: &quot;(.+)&quot;,</span><span class="w"></span>
<span class="w">            </span><span class="no">ldapQuery: &quot;dc=example,dc=com??sub?(&amp;(objectClass=organizationalPerson)(userPrincipalName={0}))&quot;</span><span class="w"></span>
<span class="w">          </span><span class="no">}</span><span class="w"></span>
<span class="w">        </span><span class="no">]</span><span class="w"></span>

<span class="w">  </span><span class="nt">setParameter</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">authenticationMechanisms</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;PLAIN&quot;</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p>Restart the <code>mongod</code> service:</p>
<div class="highlight"><pre><span></span><code>$ sudo systemctl restart mongod
</code></pre></div>
</li>
<li>
<p>Test the access to Percona Server for MongoDB:</p>
<div class="highlight"><pre><span></span><code>$ mongo -u <span class="s2">&quot;alice&quot;</span> -p <span class="s2">&quot;secretpwd&quot;</span> --authenticationDatabase <span class="s1">&#39;$external&#39;</span> --authenticationMechanism <span class="s1">&#39;PLAIN&#39;</span>
</code></pre></div>
</li>
</ol>
</div>
</div>
<p>Modify one of this example configuration to match your deployment.</p>
<div class="admonition admonition">
<p>This document is based on the following posts from Percona Database Performance Blog:</p>
<ul>
<li><a href="https://www.percona.com/blog/2020/04/24/percona-server-for-mongodb-ldap-enhancements-user-to-dn-mapping/">Percona Server for MongoDB LDAP Enhancements: User-to-DN Mapping</a> by Igor Solodovnikov</li>
<li><a href="https://www.percona.com/blog/2021/07/08/authenticate-percona-server-for-mongodb-users-via-native-ldap/">Authenticate Percona Server for MongoDB Users via Native LDAP</a> by Ivan Groenewold</li>
</ul>
</div>
<p><em>[DN]: Distinguished Name
</em>[AD]: Active Directory</p>

                
<div class="md-relbar2__inner md-grid">
<div class="md-content">
  <article class="md-content__inner md-typeset" role="main">    
    <h4>Contact Us </h4>
       <p>For free technical help, visit the Percona <a class="reference external" href="https://forums.percona.com/c/mongodb/percona-server-for-mongodb/17?utm_campaign=Doc%20pages" target="_blank">Community Forum</a>.<br>
        <p>To report bugs or submit feature requests, open a <a class="reference external" href="https://jira.percona.com/projects/PSMDB/issues/" target="_blank">JIRA</a> ticket.<br>
         <p>For paid <a class="reference external" href="https://www.percona.com/services/support"> support </a> and <a class="reference external" href="https://www.percona.com/services/managed-services"> managed </a> or <a class="reference external" href="https://www.percona.com/services/consulting">consulting services </a>, contact <a class="reference external" href="https://www.percona.com/about-percona/contact" target="_blank">Percona Sales</a>.</p>
 </article>
</div>
</div>

                <!-- Last update of source file -->
                
                  
                    <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 10, 2022</span>
      
        <br>
        Created:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 10, 2022</span>
      
    
  </small>
</div>
                  
                
              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="authorization.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: LDAP authorization" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              LDAP authorization
            </div>
          </div>
        </a>
      
      
        
        <a href="data-at-rest-encryption.html" class="md-footer__link md-footer__link--next" aria-label="Next: Data at rest encryption" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Data at rest encryption
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
    <div class="md-copyright__highlight">
 <a href='https://percona.com' target='_blank'>Percona LLC and/or its affiliates, </a> &copy; 2022
    </div>
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
              
      <script src="assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="js/version-select.js"></script>
      
        <script src="js/promptremover.js"></script>
      
    

              <img src="https://tracking.g2crowd.com/attribution_tracking/conversions/1007137.gif?e=" width="1" height="1" />

              <noscript>
                <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K48FGP2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
              </noscript>
              
  </body>
</html>