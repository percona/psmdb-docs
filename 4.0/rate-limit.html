

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  <script>
      window.ga = window.ga || function () {
          (ga.q = ga.q || []).push(arguments)
      };
      ga.l = +new Date;
      ga('create', 'UA-343802-3', 'auto');
      ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  
  
    <title>Profiling Rate Limit &#8212; Percona Server for MongoDB 4.0 Documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/../_static/css/material.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <link rel="shortcut icon" href="_static/percona_favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="copyright" title="Copyright" href="copyright.html" />
    <link rel="next" title="Authentication" href="authentication.html" />
    <link rel="prev" title="Hot Backup" href="hot-backup.html" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WBVF48V');</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WBVF48V"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  
   

  </head>
  <body dir=ltr
        data-md-color-primary=orange data-md-color-accent=grey>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#rate-limit" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://www.percona.com/software/documentation" title="Percona Server for MongoDB 4.0 Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="_static/percona-logo.svg" height="26"
                   alt="Percona Server for MongoDB 4.0 Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic"> <a href="https://www.percona.com/software/documentation">Percona Product Documentation</a></span>
          <span class="md-header-nav__topic"> Profiling Rate Limit </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="GET" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
          </div>
        </div>
      
      
  
  <div class="md-flex__cell md-flex__cell--shrink dropdown">
    <button class="dropdownbutton">Versions</button>
    <div class="dropdown-content md-hero">
          <a title="3.6 (EOL)" href="https://docs.percona.com/percona-server-for-mongodb/3.6/">3.6 (EOL)</a>
      
          <a title="4.0 (EOL)" href="https://docs.percona.com/percona-server-for-mongodb/4.0/">4.0 (EOL)</a>
      
          <a title="4.2" href="https://docs.percona.com/percona-server-for-mongodb/4.2/">4.2</a>
      
          <a title="4.4" href="https://docs.percona.com/percona-server-for-mongodb/4.4/">4.4</a>
      
          <a title="5.0" href="https://docs.percona.com/percona-server-for-mongodb/5.0/">5.0</a>
      
          <a title="6.0" href="https://docs.percona.com/percona-server-for-mongodb/6.0/">6.0</a>
      
          <a title="Latest stable" href="https://docs.percona.com/percona-server-for-mongodb/latest/">Latest stable</a>
      
    </div>
  </div>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">Percona Server for MongoDB 4.0 Documentation</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Percona Server for MongoDB 4.0 Documentation" class="md-nav__button md-logo">
      
        <img src="_static/percona-logo.svg" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="Percona Server for MongoDB 4.0 Documentation">Percona Server for MongoDB 4.0 Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/percona/psmdb-docs" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    percona/psmdb-docs
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="comparison.html" class="md-nav__link">Feature Comparison</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/index.html" class="md-nav__link">Installing Percona Server for MongoDB</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="inmemory.html" class="md-nav__link">Percona Memory Engine</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="hot-backup.html" class="md-nav__link">Hot Backup</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Profiling Rate Limit </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Profiling Rate Limit</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#rate-limit--page-root" class="md-nav__link">Profiling Rate Limit</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#comparing-to-the-samplerate-option" class="md-nav__link">Comparing to the <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> option</a>
        </li>
        <li class="md-nav__item"><a href="#enabling-the-rate-limit" class="md-nav__link">Enabling the Rate Limit</a>
        </li>
        <li class="md-nav__item"><a href="#profiler-collection-extension" class="md-nav__link">Profiler Collection Extension</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/rate-limit.rst.txt">Show Source</a> </li>

    
    <li class="md-nav__item"><a class="md-nav__extra_link" href="https://github.com/percona/psmdb-docs/edit/4.0/source/rate-limit.rst" target="_blank">
    <i class="fa fa-github"></i>    Edit this page</a> </li>
   
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="authentication.html" class="md-nav__link">Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="authorization.html" class="md-nav__link">LDAP authorization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="audit-logging.html" class="md-nav__link">Auditing</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="log-redaction.html" class="md-nav__link">Log Redaction</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="data-at-rest-encryption.html" class="md-nav__link">Data at Rest Encryption</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ngram-full-text-search.html" class="md-nav__link">Additional text search algorithm - <em>ngram</em></a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="enable-auth.html" class="md-nav__link">Enable authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="sasl-auth.html" class="md-nav__link">Set up LDAP authentication using SASL</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ldap-setup.html" class="md-nav__link">Set up LDAP authentication and authorization using NativeLDAP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="switch-storage-engines.html" class="md-nav__link">Switch storage engines</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="x509-ldap.html" class="md-nav__link">Set up x.509 authentication and LDAP authorization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="kerberos.html" class="md-nav__link">Set up Kerberos authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="set-parameter.html" class="md-nav__link">Tune parameters</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/upgrade-from-mongodb.html" class="md-nav__link">Upgrade Percona Server for MongoDB</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/upgrade-from-36.html" class="md-nav__link">Perform a major upgrade of Percona Server for MongoDB from 3.6 to 4.0</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="install/uninstall.html" class="md-nav__link">Uninstall Percona Server for MongoDB</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="release_notes/index.html" class="md-nav__link">Release notes</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="contact.html" class="md-nav__link">Contacting, Contributing, Reporting Bugs</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="glossary.html" class="md-nav__link">Glossary</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="copyright.html" class="md-nav__link">Copyright and Licensing Information</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="trademark-policy.html" class="md-nav__link">Trademark Policy</a>
      
    
    </li>
  </ul>
  

  <label class="md-nav__title md-nav__title--site" for="__drawer">
<a title="Download PDF Manual" onclick="_gaq.push(['b._trackEvent', 'Percona Server for MongoDB', 'Download', 'Download Manual Percona Server for MongoDB 4.0 ']);" href="https://learn.percona.com/download-percona-server-mongodb-4-0-manual" class="md-nav__link">Download PDF Manual <span class="glyphicon glyphicon-chevron-down"></span></a>
  </label>
</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#rate-limit--page-root" class="md-nav__link">Profiling Rate Limit</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#comparing-to-the-samplerate-option" class="md-nav__link">Comparing to the <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> option</a>
        </li>
        <li class="md-nav__item"><a href="#enabling-the-rate-limit" class="md-nav__link">Enabling the Rate Limit</a>
        </li>
        <li class="md-nav__item"><a href="#profiler-collection-extension" class="md-nav__link">Profiler Collection Extension</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/rate-limit.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

    
    <li class="md-nav__item"><a class="md-nav__extra_link" href="https://github.com/percona/psmdb-docs/edit/4.0/source/rate-limit.rst" target="_blank">
    <i class="fa fa-github"></i>    Edit this page</a> </li>
   
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            

  <div class="md-typeset alert alert-warning" role="main">    
    <p> This documentation is for the end of life version of Percona Server for MongoDB and is no longer supported. You may want to see the <a href="https://docs.percona.com/percona-server-for-mongodb/latest/index.html">current</a> documentation.
 </div>

  
<span id="rate-limit"></span><h1 id="rate-limit--page-root">Profiling Rate Limit<a class="headerlink" href="#rate-limit--page-root" title="Permalink to this headline">¶</a></h1>
<p><em>Percona Server for MongoDB</em> can limit the number of queries collected by the database profiler
to decrease its impact on performance.
Rate limit is an integer between 1 and 1000
and represents the fraction of queries to be profiled.
For example, if you set it to 20, then every 20th query will be logged.
For compatibility reasons, rate limit of 0 is the same as setting it to 1,
and will effectively disable the feature
meaning that every query will be profiled.</p>
<p>The MongoDB database profiler can operate in one of three modes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code>: Profiling is disabled. This is the default setting.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>: The profiler collects data only for <em>slow</em> queries.
By default, queries that take more than 100 milliseconds to execute
are considered <em>slow</em>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code>: Collects profiling data for all database operations.</p></li>
</ul>
<p>Mode <code class="docutils literal notranslate"><span class="pre">1</span></code> ignores all <em>fast</em> queries,
which may be the cause of problems that you are trying to find.
Mode <code class="docutils literal notranslate"><span class="pre">2</span></code> provides a comprehensive picture of database performance,
but may introduce unnecessary overhead.</p>
<p>With rate limiting you can collect profiling data for all database operations
and reduce overhead by sampling queries.
Slow queries ignore rate limiting and are always collected by the profiler.</p>

<h2 id="comparing-to-the-samplerate-option">Comparing to the <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> option<a class="headerlink" href="#comparing-to-the-samplerate-option" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> option (= <a class="reference external" href="https://docs.mongodb.com/manual/reference/program/mongod/index.html#cmdoption-mongod-slowopsamplerate">slowOpSampleRate</a> config file option) is a similar
concept to <code class="docutils literal notranslate"><span class="pre">rateLimit</span></code>. But it works at different profile level, completely
ignores operations faster than <code class="docutils literal notranslate"><span class="pre">slowOpsThresholdMs</span></code> (a.k.a. <code class="docutils literal notranslate"><span class="pre">slowMs</span></code>), and affects the
log file printing, too.</p>
<table>
<colgroup>
<col style="width: 33%"/>
<col style="width: 33%"/>
<col style="width: 33%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head stub"></th>
<th class="head"><p>sampleRate</p></th>
<th class="head"><p>rateLimit</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><th class="stub"><p>Affects profiling level 1</p></th>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Affects profiling level 2</p></th>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Discards/filters slow ops</p></th>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Discards/filters fast ops</p></th>
<td><p>no</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><th class="stub"><p>Affects log file</p></th>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><th class="stub"><p>Example value of option</p></th>
<td><p>0.02</p></td>
<td><p>50</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">rateLimit</span></code> is a better way to have continuous profiling for monitoring or live
analysis purposes. <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> requires setting slowOpsThresholdMs to zero if
you want to sample all types of operations. <code class="docutils literal notranslate"><span class="pre">sampleRate</span></code> has an effect on the log file
which may either decrease or increase the log volume.</p>


<h2 id="enabling-the-rate-limit">Enabling the Rate Limit<a class="headerlink" href="#enabling-the-rate-limit" title="Permalink to this headline">¶</a></h2>
<p>To enable rate limiting, set the profiler mode to <code class="docutils literal notranslate"><span class="pre">2</span></code>
and specify the value of the rate limit.
Optionally, you can also change the default threshold for slow queries,
which will not be sampled by rate limiting.</p>
<p>For example, to set the rate limit to <code class="docutils literal notranslate"><span class="pre">100</span></code>
(profile every 100th <em>fast</em> query)
and the slow query threshold to <code class="docutils literal notranslate"><span class="pre">200</span></code>
(profile all queries slower than 200 milliseconds),
run the <code class="docutils literal notranslate"><span class="pre">mongod</span></code> instance as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mongod --profile 2 --slowms 200 --rateLimit 100
</pre></div>
</div>
<p>To do the same at runtime,
use the <code class="docutils literal notranslate"><span class="pre">profile</span></code> command.
It returns the <em>previous</em> settings
and <code class="docutils literal notranslate"><span class="pre">"ok"</span> <span class="pre">:</span> <span class="pre">1</span></code> indicates that the operation was successful:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="n">profile</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">slowms</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="n">ratelimit</span><span class="p">:</span> <span class="mi">100</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">{</span> <span class="s2">"was"</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"slowms"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">"ratelimit"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"ok"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><em>MongoDB</em> uses the <cite>sampleRate</cite> parameter in place of <code class="docutils literal notranslate"><span class="pre">rateLimit</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><em>MongoDB</em> Documentation: The <cite>profile</cite> command</dt><dd><p><a class="reference external" href="https://docs.mongodb.com/manual/reference/command/profile/#profile">https://docs.mongodb.com/manual/reference/command/profile/#profile</a></p>
</dd>
</dl>
</div>
</div>
<p>To check the current settings, run <code class="docutils literal notranslate"><span class="pre">profile:</span> <span class="pre">-1</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="n">profile</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">{</span> <span class="s2">"was"</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"slowms"</span> <span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">"ratelimit"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">"ok"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you want to set or get just the rate limit value,
use the <code class="docutils literal notranslate"><span class="pre">profilingRateLimit</span></code> parameter on the <code class="docutils literal notranslate"><span class="pre">admin</span></code> database:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">getSiblingDB</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="n">setParameter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"profilingRateLimit"</span><span class="p">:</span> <span class="mi">100</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">{</span> <span class="s2">"was"</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"ok"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
<span class="o">&gt;</span> <span class="n">db</span><span class="o">.</span><span class="n">getSiblingDB</span><span class="p">(</span><span class="s1">'admin'</span><span class="p">)</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span> <span class="p">{</span> <span class="n">getParameter</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"profilingRateLimit"</span><span class="p">:</span> <span class="mi">1</span> <span class="p">}</span> <span class="p">);</span>
<span class="p">{</span> <span class="s2">"profilingRateLimit"</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">"ok"</span> <span class="p">:</span> <span class="mi">1</span> <span class="p">}</span>
</pre></div>
</div>
<p>If you want rate limiting to persist when you restart <code class="docutils literal notranslate"><span class="pre">mongod</span></code>,
set the corresponding variables in the MongoDB configuration file
(by default, <code class="file docutils literal notranslate"><span class="pre">/etc/mongod.conf</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">operationProfiling</span><span class="p">:</span>
  <span class="n">mode</span><span class="p">:</span> <span class="nb">all</span>
  <span class="n">slowOpThresholdMs</span><span class="p">:</span> <span class="mi">200</span>
  <span class="n">rateLimit</span><span class="p">:</span> <span class="mi">100</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The value of the <code class="docutils literal notranslate"><span class="pre">operationProfiling.mode</span></code> variable is a string,
which you can set to either <code class="docutils literal notranslate"><span class="pre">off</span></code>, <code class="docutils literal notranslate"><span class="pre">slowOp</span></code>, or <code class="docutils literal notranslate"><span class="pre">all</span></code>,
corresponding to profiling modes <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">1</span></code>, and <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p>
</div>


<h2 id="profiler-collection-extension">Profiler Collection Extension<a class="headerlink" href="#profiler-collection-extension" title="Permalink to this headline">¶</a></h2>
<p>Each document in the <code class="docutils literal notranslate"><span class="pre">system.profile</span></code> collection
includes an additional <code class="docutils literal notranslate"><span class="pre">rateLimit</span></code> field.
This field always has the value of <code class="docutils literal notranslate"><span class="pre">1</span></code> for <em>slow</em> queries
and the current rate limit value for <em>fast</em> queries.</p>




          </article>
        </div>
      </div>
    </main>
  </div>
<div class="md-relbar2__inner md-grid">
<div class="md-content">
  <article class="md-content__inner md-typeset" role="main">    
    <h4>Contact Us </h4>
       <p>For free technical help, visit the Percona <a class="reference external" href="https://forums.percona.com/c/mongodb/percona-server-for-mongodb/17?utm_campaign=Doc%20pages" target="_blank">Community Forum</a>.<br>
        <p>To report bugs or submit feature requests, open a <a class="reference external" href="https://jira.percona.com/projects/PSMDB/issues/" target="_blank">JIRA</a> ticket.<br>
         <p>For paid <a class="reference external" href="https://www.percona.com/services/support"> support </a> and <a class="reference external" href="https://www.percona.com/services/managed-services"> managed </a> or <a class="reference external" href="https://www.percona.com/services/consulting">consulting services </a>, contact <a class="reference external" href="https://www.percona.com/about-percona/contact" target="_blank">Percona Sales</a>.</p>
         <hr>
          <small> Last update: Jul 15, 2020 </small>
 </article>
</div>
</div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="hot-backup.html" title="Hot Backup"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Hot Backup </span>
              </div>
            </a>
          
          
            <a href="authentication.html" title="Authentication"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Authentication </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169;
                <a href="copyright.html">Copyright</a> Percona LLC and/or its affiliates 2015-2022.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 4.2.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>