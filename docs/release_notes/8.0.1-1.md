# Percona Server for MongoDB 8.0.1 ({{date.8_0_1}}) 

[Installation](../install/index.md){.md-button}
[Upgrade](../install/upgrade-from-70.md){.md-button}

We are pleased to announce the release candidate of the new major version of Percona Server for MongoDB 8.0.1-1 – the drop in replacement for MongoDB Community Edition. Percona Server for MongoDB supports MongoDB Community protocols and drivers and enhances it with the [enterprise-grade features for free](../comparison.md), enabling you to effectively meet the requirements of your organization in terms of high-availability, reliability and data security. 

This release of Percona Server for MongoDB includes the improvements and bug fixes of [MongoDB 8.0.0 Community Edition](https://www.mongodb.com/docs/manual/release-notes/8.0/#8.0.0---oct-2--2024) and [MongoDB 8.0.1 Community Edition](https://www.mongodb.com/docs/manual/release-notes/8.0/#8.0.1---upcoming)

## Upgrade considerations

Starting with version 8.0, Percona Server for MongoDB uses the upgraded TCMalloc to handle memory requests more efficiently. The use of TCMalloc requires enabling Transparent Huge Pages (THP) and per-CPU caches before you start Percona Server for MongoDB. Read more about TCMalloc in [MongoDB documentation :octicons-external-link-16:](https://www.mongodb.com/docs/manual/administration/tcmalloc-performance/)


## Release Highlights

In addition to the [upstream improvements](#upstream-improvements), Percona Server for MongoDB features the following improvements:

### Prevent master encryption key loss on the Vault server

Before Percona Server for MongoDB puts a new master encryption key to the Vault server as the versioned secret, it now checks if the secret's version reached the defined maximum (10 by default). This prevents the loss of the old secret and the master encryption key it stores on the Vault server. 

Make sure Percona Server for MongoDB has read permissions for the secret's metadata and the secrets engine configuration. To learn more, refer to the [documentation](../vault.md#master-key-loss-prevention).

### Join Percona Squad

Participate in monthly SWAG raffles, get an early access to new product features and invite-only “ask me anything” sessions with database performance experts. Interested? Fill in the form at [squad.percona.com/mongodb](squad.percona.com/mongodb).

### Upstream Improvements

MongoDB 8.0 introduces a lot of major changes. We recommend testing it on staging environments before using it in production. The features and improvements in MongoDB 8.0 are focused on the following main areas: 

#### Performance improvements

* Insert, update or delete multiple collections in one request with the new [`bulkWrite`](https://www.mongodb.com/docs/manual/reference/command/bulkWrite/#mongodb-dbcommand-dbcmd.bulkWrite) command. Executing this command results in faster performance.
* Benefit from faster read performance when working with time series collections. Instead of processing documents individually, MongoDB now operates the abstraction of blocks of data. This also results in faster `$group` queries.
* Query plan execution has been optimized to reduce the number of scans and fetches. For single indexed and single equality queries, MongoDB skips regular query planning and executions and uses the [EXPRESS stages](https://www.mongodb.com/docs/manual/reference/explain-results/#std-label-explain-results) which improves write performance.
* MongoDB now writes and applies oplog entries for every batch in parallel. The writer and applier threads now work asynchronously, which increases replication throughput for secondaries. 
* The upgraded upgraded TCMalloc version is now the default in MongoDB. Together with THP and per-CPU cache, it reduces memory fragmentation by 18% which is especially useful during peak loads.

#### Workload management

* Analyze query performance and manage the workload in your system using [query shapes](https://www.mongodb.com/docs/manual/core/query-shapes/#std-label-query-shapes). A query shape is a set of specifications to group similar queries together. For a query shape, you add query settings instead of index filters. Query settings are persistent meaning that they remain after the cluster restart thus saving you from rerunning them in your application. A query shape has the `queryShapeHash` parameter using which you can check if the operation causes excessive workload and deny it using operation rejection filters.

#### Scaling improvements

* To better optimize resources or distribute the data more evenly across the shards, you can now [move a single unsharded collection to any shard](https://www.mongodb.com/docs/manual/core/moveable-collections/#std-label-moveable-collections) with the new `moveCollection` command. This operation is going online and the collection data is fully available during the migration. This new way to move data is flexible and the read and write behavior when you query data is transparent.
* Ensuring even data distribution across shards in your cluster is crucial. Starting with MongoDB 5.0, you can reshard a collection using a different shard key, although this operation is time-consuming. In MongoDB 8.0, you can reshard a collection using the same shard key, significantly boosting performance. This is especially beneficial for large collections, reducing resharding time from days to several hours. You can dynamically reallocate your resources based on the workload. The process is online, so your operations run uninterrupted. The ability to add or remove shards without changing the shard key makes the whole resharding process straightforward. 
* You can now [unshard a collection](https://www.mongodb.com/docs/manual/tutorial/unshard-collection/#std-label-unshard-collection-task) if it should reside on a single shard or the collection requires resource isolation. You can either specify the desired shard or the collection will be moved onto the shard with the least load. 
* You can now save costs on additional computing resources when deploying a sharded cluster. The config server replica set can now store both the configuration and the database data. Such a deployment is recommended for small clusters and is especially useful for evaluating the cluster without having to pay extra costs.
* You can now make self-managed backups in sharded clusters using `mongodump`. Run the `fsync` command with the `lock` field set to `true` from `mongos` to lock each shard and prevent further writes. Then, run `fsynckUnlock` to unlock shards.

#### Logging improvements

You can now configure database profiler to log slow operations based on the time MongoDB actually spent processing that operation. This gives you more accuracy when you analyze performance. 

#### Security improvements

* You can now run range queries on encrypted fields, specifically for numeric data types and dates. This expands the range of use cases for queryable encryption, including accounting operations, healthcare, financial services, and other strictly regulated data operations where data safety is crucial.
* The logging format in MongoDB is now [OCSF](Open Cybersecurity Schema Framework) compliant. This simplifies integration with external monitoring systems since the log output is compatible out of the box. This saves the time of your developers enabling them to focus on other tasks.

Other improvements include the following:

* [SERVER-76883](https://jira.mongodb.org/browse/SERVER-76883) - Suppressed the "role does not exist" warning log for LDAP group role resolution
* [SERVER-82221](https://jira.mongodb.org/browse/SERVER-82221) - Included commit-pending metadata entries to the listCollections and listIndexes output
* [SERVER-94635](https://jira.mongodb.org/browse/SERVER-94635) - Improved handling of logical session refresh by making the session refresh parameters configurable
* [SERVER-95244](https://jira.mongodb.org/browse/SERVER-95244) - Fixed the `tassert()` failure for upsert operations run when a client connects directly to shard
* [WT-13409](https://jira.mongodb.org/browse/WT-13409) - Fixed the data corruption issue by properly handling a return value from a function call in transaction checkpoint in WiredTiger

Find the full list of changes in the [MongoDB 8.0.1 Community Edition release notes](https://www.mongodb.com/docs/manual/release-notes/8.0/#8.0.1---)

## Changelog

### Improvements

* [PSMDB-1441](https://perconadev.atlassian.net/browse/PSMDB-1441) - Fixed the issue with master encryption keys getting lost when the number of created secrets exceeds the threshold by preventing a new secret creation and alerting users about it.

### Fixed Bugs

* [PSMDB-1527](https://perconadev.atlassian.net/browse/PSMDB-1527) - Improve the activateKeys option handling by changing its type to boolean.



